on:
  push:
    branches:
      - test

jobs:
  make-pic:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: lts/*

      - name: Install playwright
        run: |
          npx --yes playwright install --with-deps chromium

      - name: Convert files
        shell: pwsh
        run: |
          New-Item -Path /tmp/thumbs -Force -ItemType Directory
          Invoke-WebRequest -Uri https://raw.githubusercontent.com/dataplat/dbatools/master/bin/dbatools-index.json -OutFile /tmp/thumbs/index.json
          $commands = Get-Content -Path /tmp/thumbs/index.json | ConvertFrom-Json
          $commands | Select-Object -First 1

          foreach ($command in $commands) {
            $name = $command.CommandName
            echo "<h1>$name</h1>" > /tmp/thumbs/$name.html
            npx playwright screenshot --viewport-size=1200,630 /tmp/thumbs/$name.html /tmp/thumbs/$name.png
          }

      - name: Upload artifact
        uses: actions/upload-artifact@v2
        with:
          name: pics
          path: /tmp/thumbs
